# 락

![나락도 락이다](./assets/나락도%20락이다.jpg)

## 1. 테이블 락

- 읽기 락
  - 이 락이 걸린 테이블은 다른 트랜잭션에서 읽을 수 있지만 쓰기 작업은 할 수 없다.
  - 여러 트랜잭션이 동시에 읽기 락을 얻을 수 있다.
- 쓰기 락
  - 이 락이 걸린 테이블은 해당 트랜잭션 외에는 접근이 차단된다.
  - 즉 읽기와 쓰기 모두 불가능하며, 락이 해제될 떄까지 다른 트랜잭션은 대기하게 된다.

## 2. Record Lock또는 Row Lock

- 공유 락(`Shared Lock`, S-Lock)
  - 특정 레코드에 대해 읽기 작업을 수행할 때 사용된다.
  - 이 락을 가진 트랜잭션은 다른 트랜잭션도 동일한 레코드에 대해 공유 락을 걸 수 있지만, 배타적 락(exclusive lock)은 걸 수 없습니다.
- 배타적 락(`Exclusive Lock`, X-Lock)
  - 특정 레코드에 대해 쓰기 작업을 수행할 떄 사용됩니다.
  - 이 락을 가진 트랜잭션이 완료될 때까지 다른 트랜잭션은 해당 레코으데 대해 어떠한 락도 걸 수 없습니다.

## 3. 갭 락(Gap Lock)

- 갭 락은 InnoDB 스토리지 엔진이 특정 범위 내의 레코드 사이의 "갭"을 보호하기 위해서 사용됩니다. 이는 레코드 삽입에 대한 경쟁 조건을 방지하는 데 도움이 되며, 특히 반복 읽기(`REPEATABLE READ`)격리 수준에서 사용됩니다.
- 예를 들어, 어떤 범위 내의 데이터를 조회할 때 해당 범위 내의 레코드뿐만 아니라, 그 사이의 공간에도 갭 락을 걸어 다른 트랜잭션에서 새로운 레코드를 삽입하지 못하도록 합니다.

## 4. 넥스트 키 락 (Next-Key Lock)

- 넥스트 키 락은 레코드 락과 갭 락을 결합한 형태로, 특정 레코드와 그 바로 뒤에 있는 갭에 동시에 락을 겁니다. 이는 InnoDB에서 트랜잭션의 일관성을 유지하기 위해 사용하는 기술입니다. REPEATABLE READ 격리 수준에서 특히 중요합니다.

## 5. 자동 증분 락(Auto-Increment Lock)

- 자동 증가 필드를 사용하여 데이터를 삽입할 때, MySQL은 특정 락을 사용하여 동일한 트랜잭션에서 순차적으로 숫자가 증가하도록 합니다. 이는 충돌을 방지하고 자동 증가 필드의 일관성을 유지하는데 도움을 줍니다.

## 6. 명시적 락(EXPLICIT LOCK)

- GET_LOCK(), RELEASE_LOCK() 등
  - 이 함수들은 사용자 정의 락을 제공하며, 사용자 코드에서 특정 임계 구역을 보호하거나, 임시적으로 시소스를 잠글 떄 사용됩니다. 이는 트랜잭션과는 별도로 사용될 수 있습니다.

## 7. 기타 락 매커니즘

- 메타데이터 락
  - 테이블 구조 변경과 관련된 락으로, 테이블의 스키마가 변경될 때 발생합니다. 구조 변경 작업이 진행되는 동안, 해당 테이블에 대해 읽기 또는 쓰기 작업이 차단될 수 있습니다.
